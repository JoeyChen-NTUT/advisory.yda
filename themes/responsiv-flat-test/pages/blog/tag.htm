title = "tag"
url = "/tag/:tag?"
layout = "default"
is_hidden = 0
robot_index = "index"
robot_follow = "follow"

[blogRelated]
slug = "{{ :slug }}"
results = 5
direction = "desc"
postPage = "blog/post"

[blogTagSearch]
tag = "{{ :tag }}"
page = "{{ :page }}"
resultsPerPage = 10
postPage = "blog/post"
categoryPage = "blog/category"

[blogTags]
results = 5
direction = "desc"
==
<?php
function onStart()
{   
    $this->addCss('assets/css/tree.css');
    
    $this['tool'] = new class {
        public function postFilterByCategory($items) {
            $result = [];
            foreach ($items as $item) {
                foreach ($item->categories as $category) {
                    if ($category->name != "大會提案") {
                        $result[] = $item;
                        break;
                    }
                }
            }
            return $result;
        }
    };
}
?>
==
<link href="{{ 'assets/css/meeting-page/meeting-modal.css'|theme }}" rel="stylesheet">
<link href="{{ 'assets/css/meeting-page/meeting-info.css'|theme }}" rel="stylesheet">
<link href="{{ 'assets/css/proposal-page/proposal-page.css'|theme }}" rel="stylesheet">
<link href="{{ 'assets/css/proposal-page/proposal-info.css'|theme }}" rel="stylesheet">
<link href="{{ 'assets/css/proposal-page/track-side.css'|theme }}" rel="stylesheet">
<div class="container">
    {% set tag = 'tag' %}
    <h3>#{{ this.param[tag]}}</h3>
    <div class="info-box">
        <h4>相關委員：</h4>
        {% for user in blogTagSearch.tag.users %}
        <a href="{{ 'test/userpost'|page({ id:user.id }) }}"> <img src="{{user.getAvatarThumb(60)}}" width="75" height="75" style="border-radius:50%;"></a>
        {% endfor %}
    </div>
    <h4><span>相關提案</span></h4>
    <div class="row">
        {% for post in blogTagSearch.posts %}
        {% for category in post.categories %}
        {% if category.id==1%}
        <div class="col-sm-4">
            <div class="thumbnail" data-toggle="modal" data-target="#myModal">
                <div class="caption">
                    <a href="{{ post.url }}">
                        <p class="card-description JQellipsis" align="left">{{ post.title }}</p>
                    </a>
                    {% if post.level == 1 %}
                    {% partial 'progress/proposal' %}
                    <span>提案</span>
                    {%elseif post.level==2%}
                    {% partial 'progress/processing' %}
                    <span>進行中</span>
                    {%elseif post.level==3%}
                    {% partial 'progress/part_of_the_reference' %}
                    <span>部分參採</span>
                    {%elseif post.level==4%}
                    {% partial 'progress/fully_taken' %}
                    <span>完全參採</span>
                    {%elseif post.level==5%}
                    {% partial 'progress/temporarily_not_participating' %}
                    <span>暫不參採</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
        {% endfor %}
        <script src="{{ [      
            'assets/javascript/proposal/JQellipsis.js'
        ]|theme }}"></script>
    </div>
    
    {% if blogTagSearch.posts %}
    <section class="timeline">
        <link href="{{ 'assets/css/proposal-page/track-side.css'|theme }}" rel="stylesheet">
        <link href="{{ 'assets/css/user/track.css'|theme }}" rel="stylesheet">
        <section id="track" class="container">
            <div class="row">
                <h4 class="headline"><span>委員 Tracks</span></h4>
            </div>
            <div class="row">
                <div class="container">
                    <div class="col-md-12">
                        <ul class="timeline" id="timeline_head">
                            {% set posts = tool.postFilterByCategory(blogTagSearch.tag.posts) %}
                            {% set flag = true %}
                            {% for post in posts %}
                            {% if flag == true %}
                            <li>
                            {% else %}
                            <li class="timeline-inverted">
                            {% endif %}
                                <a href="{{ 'blog/post'|page }}/{{ post.slug }}" class="display-block">
                                    <div class="timeline-panel">
                                        <div class="timeline-body">
                                            <h2 class="timeline-title">{{ post.title }}</h2>
                                        </div>
                                        <div class="timeline-footer">
                                            {% for tag in post.tags %}
                                            <!-- <a class="pull-right" href="{{ 'blog/tag'|page }}/{{ tag.name }}"> -->
                                            <a href="/tag/{{ tag.name }}" class="pull-right">
                                                <!-- <span class="label label-success">{{ tag.name }}</span> -->
                                            </a>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="avatars">
                                        <div class="col-md-12">
                                            <div class="profile-picture col-lg-10 col-md-9 col-sm-8 col-xs-12">
                                                {% for user in post.getUsers %}
                                                <a href="{{ 'test/userpost'|page({ id:user.id }) }}">
                                                    <!-- <div class="avatar" style="background:url('{{user.getAvatarThumb(60)}}');"
                                                        title="{{user.name}}">
                                                    </div> -->
                                                </a>
                                                {% endfor %}
                                            </div>
                                            <div class="timeline-date col-lg-2 col-md-3 col-sm-4 col-xs-12">{{ post.published_at|date('Y-m-d') }}</div>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            {% if flag == true %}
                                {% set flag = false %}
                            {% else %}
                                {% set flag = true %}
                            {% endif %}
                            {% endfor %}
                            <li class="clearfix" style="float: none;"></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </section>
    {% else %}
    <p>No posts found.</p>
    {% endif %}
</div>